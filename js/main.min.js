$(document).ready(function(){var styleFunction=function(){return[new ol.style.Style({fill:new ol.style.Fill({color:'rgba(225, 130, 41, 0.6)'}),stroke:new ol.style.Stroke({color:'rgba(225, 92, 41, 0.8)',width:1})})]};var styleCache={};var pontoradStyle=function(feature,resolution){var size=feature.get('features').length;var text=(size==1&&resolution<60)?feature.get('features')[0].get('name'):size.toString();var style=styleCache[size];return[new ol.style.Style({image:new ol.style.Circle({radius:10,fill:new ol.style.Fill({color:'rgb(225, 130, 41)'}),stroke:new ol.style.Stroke({color:'rgb(225, 92, 41)',width:1})}),text:new ol.style.Text({scale:1.2,text:text,fill:new ol.style.Fill({color:'#fff'}),stroke:new ol.style.Stroke({color:'#000'})})})]};var styleCar={};var carStyle=function(feature,resolution){var size=feature.get('features').length;var text=(size==1&&resolution<60)?feature.get('features')[0].get('name'):size.toString();var style=carStyle[size];return[new ol.style.Style({image:new ol.style.Circle({radius:10,fill:new ol.style.Fill({color:'rgb(180, 10, 10)'}),stroke:new ol.style.Stroke({color:'rgb(180, 10, 10)',width:1})}),text:new ol.style.Text({scale:1.2,text:text,fill:new ol.style.Fill({color:'#fff'}),stroke:new ol.style.Stroke({color:'#000'})})})]};var aterStyle=function(feature,resolution){var size=feature.get('features').length;var text=(size==1&&resolution<60)?feature.get('features')[0].get('name'):size.toString();var style=aterStyle[size];return[new ol.style.Style({image:new ol.style.Circle({radius:10,fill:new ol.style.Fill({color:'rgb(180, 190, 40)'}),stroke:new ol.style.Stroke({color:'rgb(180, 160, 20)',width:1})}),text:new ol.style.Text({scale:1.2,text:text,fill:new ol.style.Fill({color:'#fff'}),stroke:new ol.style.Stroke({color:'#000'})})})]};var limStyleFunction=function(feature){return[new ol.style.Style({stroke:new ol.style.Stroke({color:'rgba(160,140,0,1)',width:3})})]};var drenagemStyle=function(feature){return[new ol.style.Style({image:new ol.style.Circle({radius:5,stroke:new ol.style.Stroke({color:'rgba(0,127,255,0.8)',width:1})}),stroke:new ol.style.Stroke({color:'rgba(0,127,255,0.8)',width:1})})]};var estradasStyle=function(feature,resolution){var text=resolution<20?feature.get('name'):'';return[new ol.style.Style({stroke:new ol.style.Stroke({color:'#A62A2A',width:2.5,}),text:new ol.style.Text({scale:1.5,text:text,fill:new ol.style.Fill({color:'#fff'}),stroke:new ol.style.Stroke({color:'#000',width:1.7})})})]};var viveiroStyle=function(feature){return[new ol.style.Style({image:new ol.style.Icon({anchor:[0.6,0.4],anchorOrigin:'bottom-right',anchorXUnits:'pixels',anchorYUnits:'pixels',offsetOrigin:'bottom-right',src:"img/viv_ico3.png"})})]};var UCsStyle=function(){return[new ol.style.Style({fill:new ol.style.Fill({color:'rgba(0, 238, 118, 0.3)'}),stroke:new ol.style.Stroke({color:'rgb(0, 238, 118)',width:1})})]};var projection=ol.proj.get('EPSG:3857');view=new ol.View({center:[-6942316.656972848,-1050856.264864603],zoom:9,maxZoom:18,minZoom:2});var mapquestLayer=new ol.layer.Tile({source:new ol.source.OSM({layer:'osm'}),visible:!1,name:'mapquest'});var bingmapsLayer=new ol.layer.Tile({source:new ol.source.BingMaps({key:'Aqh3opxIgZXX9tgD-qzCGUijcoJU_6cZfUrKzB6sWLUhddRjsXTIuRwzz7E7DDYe',imagerySet:'AerialWithLabels'}),visible:!0,name:'bingmaps'});var lotesLayer=new ol.layer.Vector({source:new ol.source.Vector({url:'data/kml/radAreaMerged.kml',format:new ol.format.KML({extractStyles:!1})}),style:styleFunction,name:'lotesLayer',visible:!1});var sedeRadLayer=new ol.source.Vector({url:'data/kml/rad_merge.kml',format:new ol.format.KML({extractStyles:!1,extractAttributes:!0})});var limlayer=new ol.layer.Vector({source:new ol.source.Vector({url:'data/kml/municipiosRioterra.kml',format:new ol.format.KML({extractStyles:!1})}),style:limStyleFunction,name:'limlayer',visible:!0});var drenagemLayer=new ol.layer.Vector({source:new ol.source.Vector({url:'data/kml/drenagem.kml',format:new ol.format.KML({extractStyles:!1})}),style:drenagemStyle,name:'drenagemLayer',visible:!1});var UCLayer=new ol.layer.Vector({source:new ol.source.Vector({url:'data/kml/ucs.kml',format:new ol.format.KML({extractStyles:!1})}),style:UCsStyle,name:'UCLayer',visible:!1});var aterLayer=new ol.source.Vector({url:'data/kml/ater.kml',format:new ol.format.KML({extractStyles:!1})});var carFLayer=new ol.source.Vector({url:'data/kml/carsMerged.kml',format:new ol.format.KML({extractStyles:!1})});var car2Layer=new ol.source.Vector({url:'data/kml/cars.kml',format:new ol.format.KML({extractStyles:!1})});var estradasLayer=new ol.layer.Vector({source:new ol.source.Vector({url:'data/kml/rodovias.kml',format:new ol.format.KML({extractStyles:!1})}),style:estradasStyle,name:'estradasLayer',visible:!1});var viveiroLayer=new ol.layer.Vector({source:new ol.source.Vector({url:'data/kml/viveiro_itapua.kml',format:new ol.format.KML({extractStyles:!1})}),style:viveiroStyle,name:'viveiroLayer',visible:!1});var clusterSource=new ol.source.Cluster({distance:40,source:sedeRadLayer});var clusters=new ol.layer.Vector({source:clusterSource,style:pontoradStyle,name:'clusters',visible:!1});var clusterCarSource=new ol.source.Cluster({distance:40,source:carFLayer});var clustersCar=new ol.layer.Vector({source:clusterCarSource,style:carStyle,name:'carLayer',visible:!1});var clusterAterSource=new ol.source.Cluster({distance:40,source:aterLayer});var clustersAter=new ol.layer.Vector({source:clusterAterSource,style:aterStyle,name:'aterLayer',visible:!1});var source=new ol.source.Vector();var vectorMeasure=new ol.layer.Vector({source:source,name:'vectorMeasure',style:new ol.style.Style({fill:new ol.style.Fill({color:'rgba(255, 255, 255, 0.2)'}),stroke:new ol.style.Stroke({color:'#ffcc33',width:2}),image:new ol.style.Circle({radius:7,fill:new ol.style.Fill({color:'#ffcc33'})})})});map=new ol.Map({target:'mapa',controls:ol.control.defaults().extend([new ol.control.ScaleLine({className:'ol-scale-line',target:document.getElementById('scale-line')}),new ol.control.Zoom({zoomInTipLabel:'Mais zoom',zoomOutTipLabel:'Menos zoom'}),new ol.control.Attribution({tipLabel:'Atribuições'}),new ol.control.FullScreen({tipLabel:'Modo Tela-cheia Entrar/Sair'})]),renderer:'canvas',layers:[mapquestLayer,bingmapsLayer,vectorMeasure,limlayer,UCLayer,drenagemLayer,estradasLayer,lotesLayer,clusters,viveiroLayer,clustersCar,clustersAter],view:view});$('#esconder').addClass('selected');$('#esconder').on('click',function(e){if($(this).hasClass('selected')){$(this).removeClass('selected');$(this).children('i').removeClass('fa-angle-left');$(this).children('i').addClass('fa-angle-right');$("#camadas").slideToggle()}
else{$(this).addClass('selected');$(this).children('i').addClass('fa-angle-left');$(this).children('i').removeClass('fa-angle-right');$("#camadas").slideToggle()}});$('#lim').addClass('selected');$('ul.classecamadas li').on('click',function(event){event.stopPropagation();var myInput=$('input',this)
if(myInput.attr('checked')){myInput.attr('checked',!1);$(this).removeClass('selected')}
else{myInput.attr('checked',!0);$(this).addClass('selected')}
var layer={arearad:[clusters,lotesLayer],areacar:clustersCar,areaater:clustersAter,drenagem:drenagemLayer,limsemeando:limlayer,estradas:estradasLayer,viveiro:viveiroLayer,ucs:UCLayer}[$(this).children('input').attr('id')];if(Array.isArray(layer)){layer.forEach(function(layer){layer.setVisible(!layer.getVisible())})}
else layer.setVisible(!layer.getVisible())});$('input[type=radio]').on('change',function(){var layer_map=$(this).val();map.getLayers().getArray().forEach(function(e){var name=e.get('name');if(name!='lotesLayer'&&name!='drenagemLayer'&&name!='zseeLayer'&&name!='aterlayer'&&name!='limlayer'&&name!='sedeRadLayer'&&name!='carLayer'&&name!='estradasLayer'&&name!='clusters'&&name!='viveiroLayer'&&name!='UCLayer'&&name!='vectorMeasure'&&name!='geomorfologiaLayer'&&name!='geologiaLayer')
e.setVisible(name==layer_map)})});var geolocation=new ol.Geolocation({projection:view.getProjection(),tracking:!0});$('#geolocation').click(function(){var position=geolocation.getPosition();var point=new ol.layer.Vector({source:new ol.source.Vector({features:[new ol.Feature({geometry:new ol.geom.Point(position)})]})});map.addLayer(point);view.setCenter(position);view.setResolution(2.388);return!1});var info=$('#info');info.tooltip({animation:!1,trigger:'manual'});var displayFeatureInfo=function(pixel){info.css({left:pixel[0]+'px',top:(pixel[1]-1)+'px'});var feature=map.forEachFeatureAtPixel(pixel,function(feature){return feature});if(feature.get('name')||(feature.get('features')!=undefined&&feature.get('features').length==1)){info.tooltip('hide').attr('data-original-title',(feature.get('features'))?feature.get('features')[0].get('name'):feature.get('name')).tooltip('fixTitle').tooltip('show')}else{info.tooltip('hide')}};map.on('pointermove',function(evt){if(evt.dragging||!map.hasFeatureAtPixel(evt.pixel)){info.tooltip('hide');return}
displayFeatureInfo(map.getEventPixel(evt.originalEvent))});var selectlotes=new ol.style.Style({image:new ol.style.Circle({radius:5,fill:new ol.style.Fill({color:'rgba(255, 255, 0, 0.4)'}),stroke:new ol.style.Stroke({color:'rgba(255, 225, 0, 0.6)',width:2})}),fill:new ol.style.Fill({color:'rgba(255, 255, 0, 0.4)'}),stroke:new ol.style.Stroke({color:'rgba(255, 255, 0, 0.6)',width:2})});var selectInteraction=new ol.interaction.Select({layers:function(layer){return layer.get('selectable')==!0},style:[selectlotes],});map.getInteractions().extend([selectInteraction]);lotesLayer.set('selectable',!0);clusterCarSource.set('selectable',!0);var container=document.getElementById('popup');var content=document.getElementById('popup-content');var coord=document.getElementById('popup-coord')
var closer=document.getElementById('popup-closer');var overlay=new ol.Overlay(({element:container,autoPan:!0,autoPanAnimation:{duration:250}}));map.addOverlay(overlay);closer.onclick=function(){overlay.setPosition(undefined);closer.blur();return!1};map.on('singleclick',function(evt){var feature=map.forEachFeatureAtPixel(evt.pixel,function(feature,layer){return feature});if(feature&&feature.get("description")){var coordinate=evt.coordinate;var hdms=ol.coordinate.toStringHDMS(ol.proj.transform(coordinate,'EPSG:3857','EPSG:4326'));content.innerHTML='<p>'+feature.getProperties()['description']+'</p>';coord.innerHTML='<p><strong>'+hdms+'</strong></p>';overlay.setPosition(coordinate);if(feature.get("name")=="Viveiro Municipal de Itapuã do Oeste"){var initPhotoSwipeFromDOM=function(gallerySelector){var parseThumbnailElements=function(el){var thumbElements=el.childNodes,numNodes=thumbElements.length,items=[],figureEl,linkEl,size,item;for(var i=0;i<numNodes;i++){figureEl=thumbElements[i];if(figureEl.nodeType!==1){continue}
linkEl=figureEl.children[0];size=linkEl.getAttribute('data-size').split('x');item={src:linkEl.getAttribute('href'),w:parseInt(size[0],10),h:parseInt(size[1],10)};if(figureEl.children.length>1){item.title=figureEl.children[1].innerHTML}
if(linkEl.children.length>0){item.msrc=linkEl.children[0].getAttribute('src')}
item.el=figureEl;items.push(item)}
return items};var closest=function closest(el,fn){return el&&(fn(el)?el:closest(el.parentNode,fn))};var onThumbnailsClick=function(e){e=e||window.event;e.preventDefault?e.preventDefault():e.returnValue=!1;var eTarget=e.target||e.srcElement;var clickedListItem=closest(eTarget,function(el){return(el.tagName&&el.tagName.toUpperCase()==='FIGURE')});if(!clickedListItem){return}
var clickedGallery=clickedListItem.parentNode,childNodes=clickedListItem.parentNode.childNodes,numChildNodes=childNodes.length,nodeIndex=0,index;for(var i=0;i<numChildNodes;i++){if(childNodes[i].nodeType!==1){continue}
if(childNodes[i]===clickedListItem){index=nodeIndex;break}
nodeIndex++}
if(index>=0){openPhotoSwipe(index,clickedGallery)}
return!1};var photoswipeParseHash=function(){var hash=window.location.hash.substring(1),params={};if(hash.length<5){return params}
var vars=hash.split('&');for(var i=0;i<vars.length;i++){if(!vars[i]){continue}
var pair=vars[i].split('=');if(pair.length<2){continue}
params[pair[0]]=pair[1]}
if(params.gid){params.gid=parseInt(params.gid,10)}
return params};var openPhotoSwipe=function(index,galleryElement,disableAnimation,fromURL){var pswpElement=document.querySelectorAll('.pswp')[0],gallery,options,items;items=parseThumbnailElements(galleryElement);options={galleryUID:galleryElement.getAttribute('data-pswp-uid'),getThumbBoundsFn:function(index){var thumbnail=items[index].el.getElementsByTagName('img')[0],pageYScroll=window.pageYOffset||document.documentElement.scrollTop,rect=thumbnail.getBoundingClientRect();return{x:rect.left,y:rect.top+pageYScroll,w:rect.width}}};if(fromURL){if(options.galleryPIDs){for(var j=0;j<items.length;j++){if(items[j].pid==index){options.index=j;break}}}else{options.index=parseInt(index,10)-1}}else{options.index=parseInt(index,10)}
if(isNaN(options.index)){return}
if(disableAnimation){options.showAnimationDuration=0}
gallery=new PhotoSwipe(pswpElement,PhotoSwipeUI_Default,items,options);gallery.init()};var galleryElements=document.querySelectorAll(gallerySelector);for(var i=0,l=galleryElements.length;i<l;i++){galleryElements[i].setAttribute('data-pswp-uid',i+1);galleryElements[i].onclick=onThumbnailsClick}
var hashData=photoswipeParseHash();if(hashData.pid&&hashData.gid){openPhotoSwipe(hashData.pid,galleryElements[hashData.gid-1],!0,!0)}};initPhotoSwipeFromDOM('.my-gallery')}}
else if(!feature||(!feature.get('description')&&!feature.get('features'))){overlay.setPosition()}else if(feature&&(feature.get('features').length==1)){var coordinate=evt.coordinate;var hdms=ol.coordinate.toStringHDMS(ol.proj.transform(coordinate,'EPSG:3857','EPSG:4326'));content.innerHTML='<p>'+feature.get('features')[0].get("description")+'</p>';coord.innerHTML='<p><strong>'+hdms+'</strong></p>';overlay.setPosition(coordinate)}});window.measure=function(map,tipo){var wgs84Sphere=new ol.Sphere(6378137);var sketch;var helpTooltipElement;var helpTooltip;var measureTooltipElement;var measureTooltip;var continuePolygonMsg='Clique uma vez para continuar desenhando';var continueLineMsg='Clique uma vez para continuar desenhando';var pointerMoveHandler=function(evt){if(evt.dragging){return}
var helpMsg='Clique para começar a desenhar';if(sketch){var geom=(sketch.getGeometry());if(geom instanceof ol.geom.Polygon){helpMsg=continuePolygonMsg}else if(geom instanceof ol.geom.LineString){helpMsg=continueLineMsg}}
if(helpTooltipElement!=null){helpTooltipElement.innerHTML=helpMsg;helpTooltip.setPosition(evt.coordinate);helpTooltipElement.classList.remove('hidden')}};map.on('pointermove',pointerMoveHandler);map.getViewport().addEventListener('mouseout',function(){if(helpTooltipElement!=null){helpTooltipElement.classList.add('hidden')}});var geodesicCheckbox=!0;var draw;var formatLength=function(line){var length;if(geodesicCheckbox==!0){var coordinates=line.getCoordinates();length=0;var sourceProj=map.getView().getProjection();for(var i=0,ii=coordinates.length-1;i<ii;++i){var c1=ol.proj.transform(coordinates[i],sourceProj,'EPSG:4326');var c2=ol.proj.transform(coordinates[i+1],sourceProj,'EPSG:4326');length+=wgs84Sphere.haversineDistance(c1,c2)}}else{length=Math.round(line.getLength()*100)/100}
var output;if(length>100){output=(Math.round(length/1000*100)/100)+' '+'km'}else{output=(Math.round(length*100)/100)+' '+'m'}
return output};var formatArea=function(polygon){var area;if(geodesicCheckbox){var sourceProj=map.getView().getProjection();var geom=(polygon.clone().transform(sourceProj,'EPSG:4326'));var coordinates=geom.getLinearRing(0).getCoordinates();area=Math.abs(wgs84Sphere.geodesicArea(coordinates))}else{area=polygon.getArea()}
var output;if(area>1000){output=(Math.round(area/1000*100)/100)+' '+'km<sup>2</sup>'}if(area>10000){output=(Math.round(area/10000*100)/100)+' '+'ha'}else{output=(Math.round(area*100)/100)+' '+'m<sup>2</sup>'}
return output};function addInteraction(){var type=(tipo=='area'?'Polygon':'LineString');draw=new ol.interaction.Draw({source:source,type:(type),style:new ol.style.Style({fill:new ol.style.Fill({color:'rgba(255, 255, 255, 0.2)'}),stroke:new ol.style.Stroke({color:'rgba(0, 0, 0, 0.5)',lineDash:[10,10],width:2}),image:new ol.style.Circle({radius:5,stroke:new ol.style.Stroke({color:'rgba(0, 0, 0, 0.7)'}),fill:new ol.style.Fill({color:'rgba(255, 255, 255, 0.2)'})})})});map.addInteraction(draw);createMeasureTooltip();createHelpTooltip();var listener;draw.on('drawstart',function(evt){sketch=evt.feature;var tooltipCoord=evt.coordinate;listener=sketch.getGeometry().on('change',function(evt){var geom=evt.target;var output;if(geom instanceof ol.geom.Polygon){output=formatArea(geom);tooltipCoord=geom.getInteriorPoint().getCoordinates()}else if(geom instanceof ol.geom.LineString){output=formatLength(geom);tooltipCoord=geom.getLastCoordinate()}
measureTooltipElement.innerHTML=output;measureTooltip.setPosition(tooltipCoord)})},this);draw.on('drawend',function(){measureTooltipElement.className='tooltip2 tooltip2-static';measureTooltip.setOffset([0,-7]);sketch=null;setTimeout(function(){draw.setActive(!1)},100);measureTooltipElement=null;helpTooltipElement=null;helpTooltip.setPosition()},this)};function createHelpTooltip(){if(helpTooltipElement){helpTooltipElement.parentNode.removeChild(helpTooltipElement)}
helpTooltipElement=document.createElement('div');helpTooltipElement.className='tooltip2 hidden';helpTooltip=new ol.Overlay({element:helpTooltipElement,offset:[15,0],positioning:'center-left'});map.addOverlay(helpTooltip)};function createMeasureTooltip(){if(measureTooltipElement){measureTooltipElement.parentNode.removeChild(measureTooltipElement)}
measureTooltipElement=document.createElement('div');measureTooltipElement.className='tooltip2 tooltip2-measure';measureTooltip=new ol.Overlay({element:measureTooltipElement,offset:[0,-20],positioning:'bottom-center'});map.addOverlay(measureTooltip)};addInteraction()}})